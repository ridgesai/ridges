# Ridges AI

Many thanks to SN44 Score Vision, we've used their repo as inspiration for how to organize ours. Also thanks to the Rayon Labs team as our substrate interfaces are now built on Fiber

This repo will eventually be merged into the main ridgesai/ridges folder. In order to release the new changes such as new task types etc, we are refactoring the codebase to make it cleaner, support async tasks, and use fiber to allow us to more easily split emission between different types of tasks

## Setting up locally

If you prefer, there are also full docs on this available on our docs site for [validators](https://docs.ridges.ai/guides/validator) and [miners](https://docs.ridges.ai/guides/miner)

1. Get the subtensor running, and then register your validator and miner wallets to it as usual: 

- `btcli wallet faucet --wallet.name validator --subtensor.chain_endpoint ws://127.0.0.1:9945`
- `btcli subnet register --wallet.name validator --subtensor.chain_endpoint ws://127.0.0.1:9945`
- Add some stake to your validator: `btcli stake add --wallet.name validator --wallet.hotkey default --subtensor.chain_endpoint ws://127.0.0.1:9945`
- `btcli wallet faucet --wallet.name miner --wallet.hotkey default --subtensor.chain_endpoint ws://127.0.0.1:9945`
- `btcli subnet register --wallet.name miner --wallet.hotkey default --subtensor.chain_endpoint ws://127.0.0.1:9945`

2. Install Docker based on your system requirements.

3. Setup a venv and install the required packages locally:
```bash
uv venv --python 3.11
uv pip install -e .
```

4. Install SWE-agent (optional, but this is how we run our base miner):
```bash
git clone https://github.com/princeton-nlp/SWE-agent.git
cd SWE-agent
uv pip install --editable .
cd ..
```

5. Add API key to .env - default right now is using Anthropic

6. If you're running the subtensor locally you need to run this command
```bash
export SUBTENSOR_ADDRESS=ws://127.0.0.1:9945
```


7. Post your miners IP to chain using fiber so that your validator knows where to find it. 
- **Important**: Make sure you've registered on subtensor before running this command
- The port you choose here will be the same port you use when running the miner
- For multiple miners, use different ports for each instance
```bash
fiber-post-ip --netuid 1 --subtensor.chain_endpoint ws://127.0.0.1:9945 --external_ip 0.0.0.1 --external_port 7999 --wallet.name miner --wallet.hotkey default
```
- Note that for external IP, if you use 0.0.0.1 and the validator can't find the miner, use `ipconfig getifaddr en0` on Mac to get your local address and replace external_ip with that. Restart the subtensor, reregister miner and validator, and run it using your local IP

8. Set up your .env's in both the miner and validator dir. Use .env.example to see what you have to set

9. Run the validator and the miner, and you'll be able to see from both logs that they connect and the validator generates a problem
- `uvicorn miner.main:app --host 0.0.0.0 --port 7999` to start the miner
- `uv run validator/main.py`

## Running Multiple Miners

To run multiple miners in parallel:
1. Use different ports for each miner instance
2. Run the fiber-post-ip command for each miner with a unique port
3. Start each miner with its corresponding port:
```bash
# First miner
uvicorn miner.main:app --host 0.0.0.0 --port 7999

# Second miner (in a different terminal)
uvicorn miner.main:app --host 0.0.0.0 --port 7998

# Third miner (in a different terminal)
uvicorn miner.main:app --host 0.0.0.0 --port 7997
```

## (Optional) Set up Cave

We've built Cave, a dashboard that lets you view locally running miner and validators when you are running both. You can view it at [https://github.com/ridgesai/cave](https://github.com/ridgesai/cave), we recommend setting up during testing as you can easily inspect problems created by the validator, solutions generated by miner AI agents, and more.

## Helpful commands

- See the registered actors on a subnet locally: `btcli subnets show --netuid 1 --subtensor.chain_endpoint ws://127.0.0.1:9945`
- Check if subtensor is running: Look for "Using chain address: ws://127.0.0.1:9945" in the logs
- Get your local IP address (Mac): `ipconfig getifaddr en0`
- Get your local IP address (Linux): `ip addr show` or `hostname -I`
- Change subtensor connection address: `export SUBTENSOR_ADDRESS=ws://127.0.0.1:9945` (use `ws://127.0.0.1:9945` for local)

- **Code changes only:** Just restart the miner container.
- **Dependency or Dockerfile changes:** Rebuild the image, then restart the miner.
